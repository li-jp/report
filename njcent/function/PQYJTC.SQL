CREATE OR REPLACE FUNCTION PQYJTC(YJ IN NUMBER, NUM IN NUMBER)
  RETURN NUMBER IS
  R1     NUMBER;
  RESULT NUMBER;
BEGIN
  SELECT T.RATIO
  INTO   R1
  FROM   JX_RATIO T
  WHERE  T.TYPE = 3
  AND    T.LOWER <= YJ / NUM
  AND    T.UPPER > YJ / NUM
  AND    T.INPUT_TIME =
         (SELECT MAX(T1.INPUT_TIME)
           FROM   JX_RATIO T1
           WHERE  T1.TYPE = T.TYPE
           AND    T1.LOWER = T.LOWER
           AND    T1.UPPER = T.UPPER
           AND    TO_CHAR(T1.INPUT_TIME, 'yyyy-MM-dd') <=
                  TO_CHAR(LAST_DAY(VIEW_DATE.GET_DATE), 'yyyy-MM-dd'));

  RESULT := YJ * R1;
  RETURN(RESULT);
END PQYJTC;
